{% extends 'sitio_web/base.html' %}

{% block title %}Detalle proyecto (Trabajador){% endblock %}

{% block content %}
<div class="container mt-4">
    <h1 class="mb-4">Detalle del Proyecto (Trabajador)</h1>

    <div class="card mb-4">
        <div class="card-header">
            Información General
        </div>
        <div class="card-body">
            <p><strong>Nombre del Proyecto:</strong> {{ project.name }}</p>
            <p><strong>Descripción:</strong> {{ project.description }}</p>
            <p><strong>Dirección:</strong> {{ project.address }}</p>
            <p><strong>Ciudad:</strong> {{ project.city }}</p>
            <p><strong>Cliente:</strong>
                {% if project.client %}
                    {{ project.client.username }}
                {% else %}
                    No asignado
                {% endif %}
            </p>
            <p><strong>Estado:</strong>
                <span class="badge bg-info">{{ project.get_status_display }}</span>
            </p>
            <p><strong>Porcentaje de Avance:</strong>
                <span class="badge bg-success">{{ project.progress_percent }}%</span>
            </p>
            <div class="progress mb-3">
                <div class="progress-bar" role="progressbar"
                     style="width: {{ project.progress_percent }}%;"
                     aria-valuenow="{{ project.progress_percent }}"
                     aria-valuemin="0" aria-valuemax="100"></div>
            </div>
            <p><strong>Fecha de Inicio:</strong> {{ project.start_date|date:"d/m/Y" }}</p>
            <p><strong>Fecha de Fin Estimada:</strong> {{ project.end_date|date:"d/m/Y" }}</p>
        </div>
    </div>

    <div class="card mb-4">
        <div class="card-header d-flex justify-content-between align-items-center">
            <span>Historial de Avances</span>
            <a href="{% url 'worker_add_update' project.id %}" class="btn btn-sm btn-primary">
                Registrar nuevo avance
            </a>
        </div>
        <div class="card-body">
            {% if updates %}
                <ul class="list-group">
                    {% for update in updates %}
                        <li class="list-group-item">
                            <strong>{{ update.date|date:"d/m/Y" }}</strong>
                            {% if update.author %}- {{ update.author.username }}{% endif %}
                            : {{ update.comment }} ({{ update.progress_percent }}%)
                            {% if update.image %}
                                <br>
                                <img src="{{ update.image.url }}" alt="Imagen de avance"
                                     class="img-fluid mt-2" style="max-width: 300px;">
                            {% endif %}
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p>No hay avances registrados para este proyecto.</p>
            {% endif %}
        </div>
    </div>

    <div class="mt-3">
        <a href="{% url 'dashboard' %}" class="btn btn-secondary">Volver al panel</a>
    </div>
</div>
{% endblock %}